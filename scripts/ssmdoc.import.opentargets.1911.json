{
   "schemaVersion":"2.2",
   "description":"Downloads OpenTargets Source files and moves them to S3",
   "parameters":{
        "openTargetsSourceFileTargetBucketLocation": {
          "type": "String",
          "description": "Bucket to store the open targets files in."
        },  
        "executionTimeout": {
          "type": "String",
          "default": "7200",
          "description": "(Optional) The time in seconds for a command to complete before it is considered to have failed. Default is 3600 (1 hour). Maximum is 172800 (48 hours).",
          "allowedPattern": "([1-9][0-9]{0,3})|(1[0-9]{1,4})|(2[0-7][0-9]{1,3})|(28[0-7][0-9]{1,2})|(28800)"
        }
    },
    "mainSteps":[
      {
        "action":"aws:runShellScript",
        "name":"DownloadAndImportOpenTargets1911intoS3",
        "inputs":{
            "timeoutSeconds": "{{ executionTimeout }}",
            "runCommand": [
              "rm -rf opentargets/sourceExports/open-targets-data-releases/19.11/",
              "wget https://storage.googleapis.com/open-targets-data-releases/19.11/output/19.11_association_data.json.gz -P opentargets/sourceExports/open-targets-data-releases/19.11/output/19.11_association_data/",
              "wget https://storage.googleapis.com/open-targets-data-releases/19.11/output/19.11_evidence_data.json.gz -P opentargets/sourceExports/open-targets-data-releases/19.11/output/19.11_evidence_data/",
              "wget https://storage.googleapis.com/open-targets-data-releases/19.11/output/19.11_target_list.csv.gz -P opentargets/sourceExports/open-targets-data-releases/19.11/output/19.11_target_list/",
              "wget https://storage.googleapis.com/open-targets-data-releases/19.11/output/19.11_disease_list.csv.gz -P opentargets/sourceExports/open-targets-data-releases/19.11/output/19.11_disease_list/",
              "aws s3 sync opentargets/sourceExports/* s3://{{openTargetsSourceFileTargetBucketLocation}}/opentargets/sourceExports/"
            ]
         }
      }
   ]
}
